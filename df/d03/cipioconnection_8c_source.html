<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpENer - Open Source EtherNet/IP(TM)  I/O Target Stack: src/cip/cipioconnection.c Source File</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpENer - Open Source EtherNet/IP(TM)  I/O Target Stack
   &#160;<span id="projectnumber">1.2</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('df/d03/cipioconnection_8c.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/cip/cipioconnection.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../df/d03/cipioconnection_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2011, Rockwell Automation, Inc.</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> ******************************************************************************/</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d45/cipioconnection_8h.html">cipioconnection.h</a>&quot;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dc2/generic__networkhandler_8h.html">generic_networkhandler.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html">cipconnectionmanager.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/cipassembly_8h.html">cipassembly.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dad/ciptcpipinterface_8h.html" title="Public interface of the TCP/IP Interface Object.">ciptcpipinterface.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d14/cipcommon_8h.html">cipcommon.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dc0/appcontype_8h.html">appcontype.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/dff/cpf_8h.html">cpf.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d1b/trace_8h.html" title="Tracing infrastructure for OpENer.">trace.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/dec/endianconv_8h.html" title="Responsible for Endianess conversion.">endianconv.h</a>&quot;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8a">00021</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00022"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa50254fb5a0ad1f39f5170f6c390f0db1">00022</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa50254fb5a0ad1f39f5170f6c390f0db1">kCipConnectionObjectTransportClassTriggerClassInvalid</a> = -1,
<a name="l00023"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa7427c78dab3b3ca8863f5ef6caca6797">00023</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa7427c78dab3b3ca8863f5ef6caca6797">kCipConnectionObjectTransportClassTriggerClass0</a> = 0,
<a name="l00024"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa29b324eb9775a5623a397f6eab5fa091">00024</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa29b324eb9775a5623a397f6eab5fa091">kCipConnectionObjectTransportClassTriggerClass1</a> = 1,
<a name="l00025"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aade4d3151a074a65d208f147b55924a13">00025</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aade4d3151a074a65d208f147b55924a13">kCipConnectionObjectTransportClassTriggerClass2</a> = 2,
<a name="l00026"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aabbdb57a73b04cb72f9c2f68e0fff8a3b">00026</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aabbdb57a73b04cb72f9c2f68e0fff8a3b">kCipConnectionObjectTransportClassTriggerClass3</a> = 3,
<a name="l00027"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa0b97dfc182caf2a422ffa5fa4dc43534">00027</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa0b97dfc182caf2a422ffa5fa4dc43534">kCipConnectionObjectTransportClassTriggerClass4</a> = 4,
<a name="l00028"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa2c9e6ce77fa62713d140c47683bd6dd3">00028</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa2c9e6ce77fa62713d140c47683bd6dd3">kCipConnectionObjectTransportClassTriggerClass5</a> = 5,
<a name="l00029"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aaa3a914ff05d6f8e2b00147c6e6ca1553">00029</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aaa3a914ff05d6f8e2b00147c6e6ca1553">kCipConnectionObjectTransportClassTriggerClass6</a> = 6
<a name="l00030"></a>00030 } <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8a">CipConnectionObjectTransportClassTriggerClass</a>;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#aabcddf69bfc448fff15044d61dbf9b65">00033</a> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#aabcddf69bfc448fff15044d61dbf9b65">kConnectionPointConsumer</a> = 0; 
<a name="l00034"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#ac91e927d82030bc35f3f54cb3cf21452">00034</a> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#ac91e927d82030bc35f3f54cb3cf21452">kConnectionPointProducer</a> = 1; 
<a name="l00035"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a40ed6631834d2bde61a033499870a0af">00035</a> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a40ed6631834d2bde61a033499870a0af">kConnectionPointConfig</a> = 2; 
<a name="l00041"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#ac135b4e48a22ceabff84d2147f00e73d">00041</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00042"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#ac135b4e48a22ceabff84d2147f00e73daed5eda863b8019d3edca8fdac1df8bba">00042</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#ac135b4e48a22ceabff84d2147f00e73daed5eda863b8019d3edca8fdac1df8bba">PointToMultipoint</a> = 1, 
<a name="l00043"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#ac135b4e48a22ceabff84d2147f00e73dae393317b471be5998af43963b2683ec9">00043</a>   <a class="code" href="../../df/d03/cipioconnection_8c.html#ac135b4e48a22ceabff84d2147f00e73dae393317b471be5998af43963b2683ec9">PointToPoint</a> = 2 
<a name="l00044"></a>00044 } <a class="code" href="../../df/d03/cipioconnection_8c.html#ac135b4e48a22ceabff84d2147f00e73d" title="The cardinality of a connection endpoint, either point to point or point to multipoint.">CommunicationEndpointCardinality</a>;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">/*The port to be used per default for I/O messages on UDP.*/</span>
<a name="l00047"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">00047</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a> = 0x08AE;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">/* producing multicast connection have to consider the rules that apply for</span>
<a name="l00050"></a>00050 <span class="comment"> * application connection types.</span>
<a name="l00051"></a>00051 <span class="comment"> */</span>
<a name="l00052"></a>00052 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a281f0a261db50e297593dd3383093fb0">OpenProducingMulticastConnection</a>(
<a name="l00053"></a>00053   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00054"></a>00054   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data);
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a9937b2aeb5fd393c7861e25f04c9f1c1">OpenMulticastConnection</a>(
<a name="l00057"></a>00057   <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42" title="Communication direction of an UDP socket; consuming is receiver, producing is sender.">UdpCommuncationDirection</a> direction,
<a name="l00058"></a>00058   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00059"></a>00059   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data);
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a36b4eefe81166b26625074031ba87234" title="Open a Point2Point connection dependent on pa_direction.">OpenConsumingPointToPointConnection</a>(
<a name="l00062"></a>00062   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<span class="keyword">const</span> <a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00063"></a>00063   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *<span class="keyword">const</span> common_packet_format_data);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#ab5ba6f9cb3103c1db76c2bf7ae3cce8d">OpenProducingPointToPointConnection</a>(
<a name="l00066"></a>00066   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00067"></a>00067   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data);
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a092519d4bb79e85405f3bae92391ab71">HandleConfigData</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="comment">/* Regularly close the IO connection. If it is an exclusive owner or input only</span>
<a name="l00072"></a>00072 <span class="comment"> * connection and in charge of the connection a new owner will be searched</span>
<a name="l00073"></a>00073 <span class="comment"> */</span>
<a name="l00074"></a>00074 <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#adb77dcdc1545600764cd212783f5c4e2">CloseIoConnection</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a043e7b682698cb5a50ced76b6ce10293">HandleIoConnectionTimeOut</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>);
<a name="l00077"></a>00077 
<a name="l00084"></a>00084 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a41f8d71772b5defa587ac0da6124cc47" title="Send the data from the produced CIP Object of the connection via the socket of the connection object ...">SendConnectedData</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>);
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#aca3c7cb7fc5d8d3f86698cb4c31f108f">HandleReceivedIoConnectionData</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00087"></a>00087                                          <span class="keyword">const</span> <a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *data,
<a name="l00088"></a>00088                                          <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> data_length);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="comment">/**** Global variables ****/</span>
<a name="l00091"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#a534c0a24266039f7ced0d36b7c5496bc">00091</a> <a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *<a class="code" href="../../df/d03/cipioconnection_8c.html#a534c0a24266039f7ced0d36b7c5496bc">g_config_data_buffer</a> = NULL; 
<a name="l00092"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#ad20328302a359540d55f48ae36f7237d">00092</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a> = 0; 
<a name="l00094"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">00094</a> <a class="code" href="../../d7/d69/typedefs_8h.html#abf2dd49262551294eb990ef8746a2767">EipUint32</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">g_run_idle_state</a>; 
<a name="l00096"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a8397d54b331a95a673f773cd39c1e484">00096</a> <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a8397d54b331a95a673f773cd39c1e484">ProcessProductionInhibitTime</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *io_connection_object) {
<a name="l00097"></a>00097   <span class="keywordflow">if</span> ( <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#affddff21539d9aca8230015a12ebd6e6a2716ecbc6f36e1f7f6634d6a7c66767f">kProductionTriggerCyclic</a>
<a name="l00098"></a>00098        == <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#ac0268f2d6ccda7e8cad9c2c37715510e">GetProductionTrigger</a>(io_connection_object) ) {
<a name="l00099"></a>00099     <span class="keywordflow">if</span> ( 256 == <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#a7a07ae8e40025b1ed31cb09e84d172c0">GetProductionInhibitTime</a>(io_connection_object) ) {
<a name="l00100"></a>00100       <span class="comment">/* there was no PIT segment in the connection path; set PIT to one fourth of RPI */</span>
<a name="l00101"></a>00101       <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#aa07c30f7dfcecb7317728972a4ee1185">SetProductionInhibitTime</a>(
<a name="l00102"></a>00102         <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#a0943ab7d9dfedcfda9b11513080d47b5">GetTargetToOriginatorRequestedPackedInterval</a>(io_connection_object)
<a name="l00103"></a>00103         / 4000,
<a name="l00104"></a>00104         io_connection_object);
<a name="l00105"></a>00105     } <span class="keywordflow">else</span> {
<a name="l00106"></a>00106       <span class="comment">/* If a production inhibit time is provided, it needs to be smaller than the Requested Packet Interval */</span>
<a name="l00107"></a>00107       <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#a7a07ae8e40025b1ed31cb09e84d172c0">GetProductionInhibitTime</a>(io_connection_object)
<a name="l00108"></a>00108            &gt; (<a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#a0943ab7d9dfedcfda9b11513080d47b5">GetTargetToOriginatorRequestedPackedInterval</a>(io_connection_object)
<a name="l00109"></a>00109               / 1000) ) {
<a name="l00110"></a>00110         <span class="comment">/* see section C-1.4.3.3 */</span>
<a name="l00111"></a>00111         <span class="keywordflow">return</span> 0x111; 
<a name="l00112"></a>00112       }
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114   }
<a name="l00115"></a>00115   <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a>;
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a6faba387e4d023277fa1e8ca014d9c03">00118</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8a">CipConnectionObjectTransportClassTriggerClass</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a6faba387e4d023277fa1e8ca014d9c03">GetConnectionTransportClass</a>(
<a name="l00119"></a>00119   <span class="keyword">const</span> <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<span class="keyword">const</span> <a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>) {
<a name="l00120"></a>00120   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> kTransportClassMask = 0x0F;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122   <span class="keywordflow">switch</span>(connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aee393bffe6bd92fb313db48832665254">transport_type_class_trigger</a> &amp;
<a name="l00123"></a>00123          kTransportClassMask) {
<a name="l00124"></a>00124     <span class="keywordflow">case</span> 0: <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa7427c78dab3b3ca8863f5ef6caca6797">kCipConnectionObjectTransportClassTriggerClass0</a>;
<a name="l00125"></a>00125     <span class="keywordflow">case</span> 1: <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa29b324eb9775a5623a397f6eab5fa091">kCipConnectionObjectTransportClassTriggerClass1</a>;
<a name="l00126"></a>00126     <span class="keywordflow">case</span> 2: <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aade4d3151a074a65d208f147b55924a13">kCipConnectionObjectTransportClassTriggerClass2</a>;
<a name="l00127"></a>00127     <span class="keywordflow">case</span> 3: <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aabbdb57a73b04cb72f9c2f68e0fff8a3b">kCipConnectionObjectTransportClassTriggerClass3</a>;
<a name="l00128"></a>00128     <span class="keywordflow">case</span> 4: <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa0b97dfc182caf2a422ffa5fa4dc43534">kCipConnectionObjectTransportClassTriggerClass4</a>;
<a name="l00129"></a>00129     <span class="keywordflow">case</span> 5: <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa2c9e6ce77fa62713d140c47683bd6dd3">kCipConnectionObjectTransportClassTriggerClass5</a>;
<a name="l00130"></a>00130     <span class="keywordflow">case</span> 6: <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aaa3a914ff05d6f8e2b00147c6e6ca1553">kCipConnectionObjectTransportClassTriggerClass6</a>;
<a name="l00131"></a>00131   }
<a name="l00132"></a>00132   <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa50254fb5a0ad1f39f5170f6c390f0db1">kCipConnectionObjectTransportClassTriggerClassInvalid</a>;
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#ac788741792b008fa0699c7cfbe0979bc">00135</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#ac788741792b008fa0699c7cfbe0979bc">SetIoConnectionCallbacks</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<span class="keyword">const</span> io_connection_object) {
<a name="l00136"></a>00136   io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a51af396f09a2874cecd1d463c85e2a34">connection_close_function</a> = <a class="code" href="../../df/d03/cipioconnection_8c.html#adb77dcdc1545600764cd212783f5c4e2">CloseIoConnection</a>;
<a name="l00137"></a>00137   io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a1188e39b93ec13c5dca2c1c56d6ab07e">connection_timeout_function</a> = <a class="code" href="../../df/d03/cipioconnection_8c.html#a043e7b682698cb5a50ced76b6ce10293">HandleIoConnectionTimeOut</a>;
<a name="l00138"></a>00138   io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ab54770913f007d4ca02e10835352649d">connection_send_data_function</a> = <a class="code" href="../../df/d03/cipioconnection_8c.html#a41f8d71772b5defa587ac0da6124cc47" title="Send the data from the produced CIP Object of the connection via the socket of the connection object ...">SendConnectedData</a>;
<a name="l00139"></a>00139   io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af885b8e00c36002715d9cbb32b56f3a2">connection_receive_data_function</a> =
<a name="l00140"></a>00140     <a class="code" href="../../df/d03/cipioconnection_8c.html#aca3c7cb7fc5d8d3f86698cb4c31f108f">HandleReceivedIoConnectionData</a>;
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a198846e6013a89a27816d2eae392b0cc">00143</a> <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a198846e6013a89a27816d2eae392b0cc">SetupIoConnectionOriginatorToTargetConnectionPoint</a>(
<a name="l00144"></a>00144   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<span class="keyword">const</span> io_connection_object,
<a name="l00145"></a>00145   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<span class="keyword">const</span> RESTRICT <a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>) {
<a name="l00146"></a>00146   <a class="code" href="../../da/d8e/structcip__class.html" title="Class is a subclass of Instance.">CipClass</a> *<span class="keyword">const</span> assembly_class = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga98bd609c80ece316406363575b4a89ea" title="Get a pointer to a CIP object with given class code.">GetCipClass</a>(kCipAssemblyClassCode);
<a name="l00147"></a>00147   <a class="code" href="../../d5/dc5/structcip__instance.html">CipInstance</a> *instance = NULL;
<a name="l00148"></a>00148   <span class="keywordflow">if</span> ( NULL
<a name="l00149"></a>00149        != ( instance =
<a name="l00150"></a>00150               <a class="code" href="../../d2/dc9/group__CIP__API.html#gaa50395aca91b378c297d6ad919df210e" title="Get a pointer to an instance.">GetCipInstance</a>(
<a name="l00151"></a>00151                 assembly_class,
<a name="l00152"></a>00152                 io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[
<a name="l00153"></a>00153                   <a class="code" href="../../df/d03/cipioconnection_8c.html#aabcddf69bfc448fff15044d61dbf9b65">kConnectionPointConsumer</a>]) ) ) {
<a name="l00154"></a>00154     <span class="comment">/* consuming Connection Point is present */</span>
<a name="l00155"></a>00155     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aef7f726017a6d89235c9ee8c0ef98d71">consuming_instance</a> = instance;
<a name="l00156"></a>00156     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a65eb419da766d2f8a43fc03b14a152f3">consumed_connection_path_length</a> = 6;
<a name="l00157"></a>00157     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ab3ad0cdf7a707fb8554f0c2705999122">consumed_connection_path</a>.<a class="code" href="../../d5/dd2/structCipEpath.html#af99160e384c9add3cd99fa48f1c83059">path_size</a> = 6;
<a name="l00158"></a>00158     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ab3ad0cdf7a707fb8554f0c2705999122">consumed_connection_path</a>.<a class="code" href="../../d5/dd2/structCipEpath.html#afa1bed6dacf38bea9ec26342f33f4fc6">class_id</a> =
<a name="l00159"></a>00159       io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#ac8161b95364182279d18be321752ee15">class_id</a>;
<a name="l00160"></a>00160     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ab3ad0cdf7a707fb8554f0c2705999122">consumed_connection_path</a>.<a class="code" href="../../d5/dd2/structCipEpath.html#a206c078bbda5b614b96cd61fd18d1cab">instance_number</a> =
<a name="l00161"></a>00161       io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[
<a name="l00162"></a>00162         <a class="code" href="../../df/d03/cipioconnection_8c.html#aabcddf69bfc448fff15044d61dbf9b65">kConnectionPointConsumer</a>];
<a name="l00163"></a>00163     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ab3ad0cdf7a707fb8554f0c2705999122">consumed_connection_path</a>.<a class="code" href="../../d5/dd2/structCipEpath.html#a4c9dee9e353080f53bcc041745849bbe">attribute_number</a> = 3;
<a name="l00164"></a>00164     <span class="keywordtype">int</span> data_size = io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a657c244a2fd4dbc4f313470bb635748a">consumed_connection_size</a>;
<a name="l00165"></a>00165     <span class="keywordtype">int</span> diff_size = 0;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="comment">/* an assembly object should always have an attribute 3 */</span>
<a name="l00168"></a>00168     <a class="code" href="../../d4/d62/structCipAttributeStruct.html">CipAttributeStruct</a> *attribute = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga5a14c8d76acacb09312b709bb0a76265" title="Get a pointer to an instance&#39;s attribute.">GetCipAttribute</a>(instance, 3);
<a name="l00169"></a>00169     <a class="code" href="../../dd/d1b/POSIX_2sample__application_2opener__user__conf_8h.html#a7b5e7d71f666ba97788b35be1617c40a">OPENER_ASSERT</a>(attribute != NULL);
<a name="l00170"></a>00170     <span class="keywordtype">int</span> is_heartbeat = ( ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length == 0 );
<a name="l00171"></a>00171     <span class="keywordflow">if</span> ( <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa29b324eb9775a5623a397f6eab5fa091">kCipConnectionObjectTransportClassTriggerClass1</a>
<a name="l00172"></a>00172          == <a class="code" href="../../df/d03/cipioconnection_8c.html#a6faba387e4d023277fa1e8ca014d9c03">GetConnectionTransportClass</a>(io_connection_object) ) {
<a name="l00173"></a>00173       <span class="comment">//if ((io_connection_object-&gt;transport_type_class_trigger &amp; 0x0F) == 1) {</span>
<a name="l00174"></a>00174       <span class="comment">/* class 1 connection */</span>
<a name="l00175"></a>00175       data_size -= 2; <span class="comment">/* remove 16-bit sequence count length */</span>
<a name="l00176"></a>00176       diff_size += 2;
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178     <span class="keywordflow">if</span> ( (kOpenerConsumedDataHasRunIdleHeader) &amp;&amp; (data_size &gt; 0)
<a name="l00179"></a>00179          &amp;&amp; (!is_heartbeat) ) {
<a name="l00180"></a>00180       <span class="comment">/* we only have an run idle header if it is not an heartbeat connection */</span>
<a name="l00181"></a>00181       data_size -= 4; <span class="comment">/* remove the 4 bytes needed for run/idle header */</span>
<a name="l00182"></a>00182       diff_size += 4;
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184     <span class="keywordflow">if</span> ( ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length != data_size ) {
<a name="l00185"></a>00185       <span class="comment">/*wrong connection size */</span>
<a name="l00186"></a>00186       connection_object-&gt;correct_originator_to_target_size =
<a name="l00187"></a>00187         ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length + diff_size;
<a name="l00188"></a>00188       <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a3607b492711350b9d9979df218f0949d">kConnectionManagerExtendedStatusCodeErrorInvalidOToTConnectionSize</a>;
<a name="l00189"></a>00189     }
<a name="l00190"></a>00190   } <span class="keywordflow">else</span> {
<a name="l00191"></a>00191     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a40a08a853d51ce12008d4c935dbef985">kConnectionManagerExtendedStatusCodeInvalidConsumingApplicationPath</a>;
<a name="l00192"></a>00192   }
<a name="l00193"></a>00193   <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a>;
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a58143f4b37db19c4acac195032340b05">00196</a> <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a58143f4b37db19c4acac195032340b05">SetupIoConnectionTargetToOriginatorConnectionPoint</a>(
<a name="l00197"></a>00197   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<span class="keyword">const</span> io_connection_object,
<a name="l00198"></a>00198   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<span class="keyword">const</span> RESTRICT <a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>) {
<a name="l00199"></a>00199   <span class="comment">/*setup producer side*/</span>
<a name="l00200"></a>00200   <a class="code" href="../../da/d8e/structcip__class.html" title="Class is a subclass of Instance.">CipClass</a> *<span class="keyword">const</span> assembly_class = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga98bd609c80ece316406363575b4a89ea" title="Get a pointer to a CIP object with given class code.">GetCipClass</a>(kCipAssemblyClassCode);
<a name="l00201"></a>00201   <a class="code" href="../../d5/dc5/structcip__instance.html">CipInstance</a> *instance = NULL;
<a name="l00202"></a>00202   <span class="keywordflow">if</span> ( 0
<a name="l00203"></a>00203        != ( instance =
<a name="l00204"></a>00204               <a class="code" href="../../d2/dc9/group__CIP__API.html#gaa50395aca91b378c297d6ad919df210e" title="Get a pointer to an instance.">GetCipInstance</a>(
<a name="l00205"></a>00205                 assembly_class,
<a name="l00206"></a>00206                 io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[
<a name="l00207"></a>00207                   <a class="code" href="../../df/d03/cipioconnection_8c.html#ac91e927d82030bc35f3f54cb3cf21452">kConnectionPointProducer</a>]) ) ) {
<a name="l00208"></a>00208     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ab486fb828cb85f57c53abea69ad9faff">producing_instance</a> = instance;
<a name="l00209"></a>00209     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7c7b4c524189f7894f06ca75187a756c">produced_connection_path_length</a> = 6;
<a name="l00210"></a>00210     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a0a9a5ce0afe8cd5890c11e901bc9a099">produced_connection_path</a>.<a class="code" href="../../d5/dd2/structCipEpath.html#af99160e384c9add3cd99fa48f1c83059">path_size</a> = 6;
<a name="l00211"></a>00211     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a0a9a5ce0afe8cd5890c11e901bc9a099">produced_connection_path</a>.<a class="code" href="../../d5/dd2/structCipEpath.html#afa1bed6dacf38bea9ec26342f33f4fc6">class_id</a> =
<a name="l00212"></a>00212       io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#ac8161b95364182279d18be321752ee15">class_id</a>;
<a name="l00213"></a>00213     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a0a9a5ce0afe8cd5890c11e901bc9a099">produced_connection_path</a>.<a class="code" href="../../d5/dd2/structCipEpath.html#a206c078bbda5b614b96cd61fd18d1cab">instance_number</a> =
<a name="l00214"></a>00214       io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[
<a name="l00215"></a>00215         <a class="code" href="../../df/d03/cipioconnection_8c.html#ac91e927d82030bc35f3f54cb3cf21452">kConnectionPointProducer</a>];
<a name="l00216"></a>00216     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a0a9a5ce0afe8cd5890c11e901bc9a099">produced_connection_path</a>.<a class="code" href="../../d5/dd2/structCipEpath.html#a4c9dee9e353080f53bcc041745849bbe">attribute_number</a> = 3;
<a name="l00217"></a>00217     <span class="keywordtype">int</span> data_size = io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a06f2c634d47a6b2883821737aff5ec03">produced_connection_size</a>;
<a name="l00218"></a>00218     <span class="keywordtype">int</span> diff_size = 0;
<a name="l00219"></a>00219     <span class="comment">/* an assembly object should always have an attribute 3 */</span>
<a name="l00220"></a>00220     <a class="code" href="../../d4/d62/structCipAttributeStruct.html">CipAttributeStruct</a> *attribute = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga5a14c8d76acacb09312b709bb0a76265" title="Get a pointer to an instance&#39;s attribute.">GetCipAttribute</a>(instance, 3);
<a name="l00221"></a>00221     <a class="code" href="../../dd/d1b/POSIX_2sample__application_2opener__user__conf_8h.html#a7b5e7d71f666ba97788b35be1617c40a">OPENER_ASSERT</a>(attribute != NULL);
<a name="l00222"></a>00222     <span class="keywordtype">int</span> is_heartbeat = ( ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length == 0 );
<a name="l00223"></a>00223     <span class="keywordflow">if</span> ( <a class="code" href="../../df/d03/cipioconnection_8c.html#a70a4241efd7aa2cac0617d836a39dd8aa29b324eb9775a5623a397f6eab5fa091">kCipConnectionObjectTransportClassTriggerClass1</a> ==
<a name="l00224"></a>00224          <a class="code" href="../../df/d03/cipioconnection_8c.html#a6faba387e4d023277fa1e8ca014d9c03">GetConnectionTransportClass</a>(io_connection_object) ) {
<a name="l00225"></a>00225       <span class="comment">/* class 1 connection */</span>
<a name="l00226"></a>00226       data_size -= 2; <span class="comment">/* remove 16-bit sequence count length */</span>
<a name="l00227"></a>00227       diff_size += 2;
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229     <span class="keywordflow">if</span> ( (kOpenerProducedDataHasRunIdleHeader) &amp;&amp; (data_size &gt; 0)
<a name="l00230"></a>00230          &amp;&amp; (!is_heartbeat) ) {
<a name="l00231"></a>00231       <span class="comment">/* we only have an run idle header if it is not an heartbeat connection */</span>
<a name="l00232"></a>00232       data_size -= 4; <span class="comment">/* remove the 4 bytes needed for run/idle header */</span>
<a name="l00233"></a>00233       diff_size += 4;
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235     <span class="keywordflow">if</span> ( ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length != data_size ) {
<a name="l00236"></a>00236       <span class="comment">/*wrong connection size*/</span>
<a name="l00237"></a>00237       connection_object-&gt;correct_target_to_originator_size =
<a name="l00238"></a>00238         ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length + diff_size;
<a name="l00239"></a>00239       <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759adc76a9410b4fab054d9b4e17d0c5b067">kConnectionManagerExtendedStatusCodeErrorInvalidTToOConnectionSize</a>;
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241   } <span class="keywordflow">else</span> {
<a name="l00242"></a>00242     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759ab31ee32e147e66520a313f02c5875510">kConnectionManagerExtendedStatusCodeInvalidProducingApplicationPath</a>;
<a name="l00243"></a>00243   }
<a name="l00244"></a>00244   <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a>;
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00258"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#a699fccd3dabdfec1b77560f22268c1e8">00258</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a699fccd3dabdfec1b77560f22268c1e8" title="Establishes a new IO Type 1 Connection.">EstablishIoConnection</a>(
<a name="l00259"></a>00259   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *RESTRICT <span class="keyword">const</span> <a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00260"></a>00260   <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> *<span class="keyword">const</span> extended_error) {
<a name="l00261"></a>00261   <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> eip_status = <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *io_connection_object = <a class="code" href="../../d1/dbc/appcontype_8c.html#a078777f6becb5dd5b858811b546dc523" title="check if for the given connection data received in a forward_open request a suitable connection is av...">GetIoConnectionForConnectionData</a>(
<a name="l00264"></a>00264     connection_object,
<a name="l00265"></a>00265     extended_error);
<a name="l00266"></a>00266   <span class="keywordflow">if</span>(NULL == io_connection_object) {
<a name="l00267"></a>00267     <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00268"></a>00268   }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270   *extended_error = <a class="code" href="../../df/d03/cipioconnection_8c.html#a8397d54b331a95a673f773cd39c1e484">ProcessProductionInhibitTime</a>(io_connection_object);
<a name="l00271"></a>00271   <span class="keywordflow">if</span>(0 != *extended_error) {
<a name="l00272"></a>00272     <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00273"></a>00273   }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275   <a class="code" href="../../df/d03/cipioconnection_8c.html#ac788741792b008fa0699c7cfbe0979bc">SetIoConnectionCallbacks</a>(io_connection_object);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#a58ea5ad416416102edd225bc918bd6bd" title="Generate the ConnectionIDs and set the general configuration parameter in the given connection object...">GeneralConnectionConfiguration</a>(io_connection_object);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4c" title="Connection Type constants of the Forward Open service request Indicates either a.">ForwardOpenConnectionType</a> originator_to_target_connection_type =
<a name="l00280"></a>00280     <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#abe98e638bb3ac01dc06d7d944a1f30bf" title="returns the connection type of the supplied network connection parameter">GetConnectionType</a>(io_connection_object
<a name="l00281"></a>00281                       -&gt;
<a name="l00282"></a>00282                       o_to_t_network_connection_parameter);
<a name="l00283"></a>00283   <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4c" title="Connection Type constants of the Forward Open service request Indicates either a.">ForwardOpenConnectionType</a> target_to_originator_connection_type =
<a name="l00284"></a>00284     <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#abe98e638bb3ac01dc06d7d944a1f30bf" title="returns the connection type of the supplied network connection parameter">GetConnectionType</a>(io_connection_object
<a name="l00285"></a>00285                       -&gt;
<a name="l00286"></a>00286                       t_to_o_network_connection_parameter);
<a name="l00287"></a>00287 
<a name="l00289"></a>00289   <a class="code" href="../../dd/d1b/POSIX_2sample__application_2opener__user__conf_8h.html#a7b5e7d71f666ba97788b35be1617c40a">OPENER_ASSERT</a>( !(originator_to_target_connection_type ==
<a name="l00290"></a>00290                    <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4cadc9c105290d2a0dbf2284cf23c1592a1">kForwardOpenConnectionTypeNull</a> &amp;&amp;
<a name="l00291"></a>00291                    target_to_originator_connection_type ==
<a name="l00292"></a>00292                    <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4cadc9c105290d2a0dbf2284cf23c1592a1">kForwardOpenConnectionTypeNull</a>) );
<a name="l00293"></a>00293 
<a name="l00294"></a>00294   io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aef7f726017a6d89235c9ee8c0ef98d71">consuming_instance</a> = NULL;
<a name="l00295"></a>00295   io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a65eb419da766d2f8a43fc03b14a152f3">consumed_connection_path_length</a> = 0;
<a name="l00296"></a>00296   io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ab486fb828cb85f57c53abea69ad9faff">producing_instance</a> = NULL;
<a name="l00297"></a>00297   io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7c7b4c524189f7894f06ca75187a756c">produced_connection_path_length</a> = 0;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="comment">/* we don&#39;t need to check for zero as this is handled in the connection path parsing */</span>
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   <span class="keywordflow">if</span> (originator_to_target_connection_type != <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4cadc9c105290d2a0dbf2284cf23c1592a1">kForwardOpenConnectionTypeNull</a>) { <span class="comment">/*setup consumer side*/</span>
<a name="l00303"></a>00303     *extended_error = <a class="code" href="../../df/d03/cipioconnection_8c.html#a198846e6013a89a27816d2eae392b0cc">SetupIoConnectionOriginatorToTargetConnectionPoint</a>(
<a name="l00304"></a>00304       io_connection_object,
<a name="l00305"></a>00305       connection_object);
<a name="l00306"></a>00306     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a> != *extended_error) {
<a name="l00307"></a>00307       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309   }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 
<a name="l00312"></a>00312   <span class="keywordflow">if</span> (target_to_originator_connection_type != <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4cadc9c105290d2a0dbf2284cf23c1592a1">kForwardOpenConnectionTypeNull</a>) { <span class="comment">/*setup producer side*/</span>
<a name="l00313"></a>00313     *extended_error = <a class="code" href="../../df/d03/cipioconnection_8c.html#a58143f4b37db19c4acac195032340b05">SetupIoConnectionTargetToOriginatorConnectionPoint</a>(
<a name="l00314"></a>00314       io_connection_object,
<a name="l00315"></a>00315       connection_object);
<a name="l00316"></a>00316     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a> != *extended_error) {
<a name="l00317"></a>00317       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319   }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 
<a name="l00322"></a>00322   <span class="keywordflow">if</span> (NULL != <a class="code" href="../../df/d03/cipioconnection_8c.html#a534c0a24266039f7ced0d36b7c5496bc">g_config_data_buffer</a>) { <span class="comment">/* config data has been sent with this forward open request */</span>
<a name="l00323"></a>00323     *extended_error = <a class="code" href="../../df/d03/cipioconnection_8c.html#a092519d4bb79e85405f3bae92391ab71">HandleConfigData</a>(io_connection_object);
<a name="l00324"></a>00324     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a> != *extended_error) {
<a name="l00325"></a>00325       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00326"></a>00326     }
<a name="l00327"></a>00327   }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   eip_status = <a class="code" href="../../df/d03/cipioconnection_8c.html#adbb39670c736df4ef89589a3b4e4df4e" title="Take the data given in the connection object structure and open the necessary communication channels...">OpenCommunicationChannels</a>(io_connection_object);  <span class="comment">// Only use T-&gt;O Sockaddr Info Item in Forward_Open Request not working</span>
<a name="l00330"></a>00330   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a> != eip_status) {
<a name="l00331"></a>00331     *extended_error = 0; <span class="comment">/*TODO find out the correct extended error code*/</span>
<a name="l00332"></a>00332     <span class="keywordflow">return</span> eip_status;
<a name="l00333"></a>00333   }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335   <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#a9414ca20f400db7e4d219dddd953a004" title="Insert the given connection object to the list of currently active and managed connections.">AddNewActiveConnection</a>(io_connection_object);
<a name="l00336"></a>00336   <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gac9c9ad2c2254b783e7b447bd84eba8c0" title="Inform the application on changes occurred for a connection.">CheckIoConnectionEvent</a>(
<a name="l00337"></a>00337     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[0],
<a name="l00338"></a>00338     io_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[1],
<a name="l00339"></a>00339     <a class="code" href="../../df/d28/ciptypes_8h.html#a1a7498137431124c4dde66e95095c2d2a6516f9d6e660daf124379a38608434e2">kIoConnectionEventOpened</a>);
<a name="l00340"></a>00340   <span class="keywordflow">return</span> eip_status;
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00349"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a36b4eefe81166b26625074031ba87234">00349</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a36b4eefe81166b26625074031ba87234" title="Open a Point2Point connection dependent on pa_direction.">OpenConsumingPointToPointConnection</a>(
<a name="l00350"></a>00350   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<span class="keyword">const</span> <a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00351"></a>00351   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *<span class="keyword">const</span> common_packet_format_data) {
<a name="l00352"></a>00352   <span class="comment">/*static EIP_UINT16 nUDPPort = 2222; TODO think on improving the udp port assigment for point to point connections */</span>
<a name="l00353"></a>00353   <span class="keywordtype">int</span> j = 0;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <span class="keywordflow">if</span> (common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> == 0) { <span class="comment">/* it is not used yet */</span>
<a name="l00356"></a>00356     j = 0;
<a name="l00357"></a>00357   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> == 0) {
<a name="l00358"></a>00358     j = 1;
<a name="l00359"></a>00359   }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <span class="keyword">struct </span>sockaddr_in addr =
<a name="l00362"></a>00362   { .sin_family = PF_INET, .sin_addr.s_addr = INADDR_ANY, .sin_port = htons(
<a name="l00363"></a>00363       <a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a>) };
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <span class="keywordtype">int</span> socket = <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gadae462526ab01253d39e4a54346f56ca" title="create a producing or consuming UDP socket">CreateUdpSocket</a>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>, &amp;addr); <span class="comment">/* the address is only needed for bind used if consuming */</span>
<a name="l00366"></a>00366   <span class="keywordflow">if</span> (socket == kEipInvalidSocket) {
<a name="l00367"></a>00367     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(
<a name="l00368"></a>00368       <span class="stringliteral">&quot;cannot create UDP socket in OpenPointToPointConnection\n&quot;</span>);
<a name="l00369"></a>00369     <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00370"></a>00370   }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a122616a0d743a67d5333a79c57ba50b8">originator_address</a> = addr; <span class="comment">/* store the address of the originator for packet scanning */</span>
<a name="l00373"></a>00373   addr.sin_addr.s_addr = INADDR_ANY; <span class="comment">/* restore the address */</span>
<a name="l00374"></a>00374   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>] = socket;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a8933e644c7191ea8f5a22401b2e6a6fa">length</a> = 16;
<a name="l00377"></a>00377   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> =
<a name="l00378"></a>00378     <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a93851549b6af1ed796409633e8071623">kCipItemIdSocketAddressInfoOriginatorToTarget</a>;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a> = addr.sin_port;
<a name="l00381"></a>00381   <span class="comment">/*TODO should we add our own address here? */</span>
<a name="l00382"></a>00382   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a46921af5bef9ee04546194f8d19d3163">sin_addr</a> = addr.sin_addr
<a name="l00383"></a>00383                                                              .s_addr;
<a name="l00384"></a>00384   memset(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#abaf556494b9fea3137c6c45522ab9bda">nasin_zero</a>, 0, 8);
<a name="l00385"></a>00385   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a> = htons(AF_INET);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00390"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#ab5ba6f9cb3103c1db76c2bf7ae3cce8d">00390</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#ab5ba6f9cb3103c1db76c2bf7ae3cce8d">OpenProducingPointToPointConnection</a>(
<a name="l00391"></a>00391   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00392"></a>00392   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data) {
<a name="l00393"></a>00393   <a class="code" href="../../db/d9c/WIN32_2sample__application_2opener__user__conf_8h.html#adc5174418a78989eb51ef56f622db6e3">in_port_t</a> port = htons(<a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a>); <span class="comment">/* the default port to be used if no port information is part of the forward open request */</span>
<a name="l00394"></a>00394 
<a name="l00395"></a>00395   <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>
<a name="l00396"></a>00396       == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00397"></a>00397     port = common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a>;
<a name="l00398"></a>00398   } <span class="keywordflow">else</span> {
<a name="l00399"></a>00399     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>
<a name="l00400"></a>00400         == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00401"></a>00401       port = common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a>;
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403   }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>.sin_family = AF_INET;
<a name="l00406"></a>00406   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>.sin_addr.s_addr = 0; <span class="comment">/* we don&#39;t know the address of the originate will be set in the IApp_CreateUDPSocket */</span>
<a name="l00407"></a>00407   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>.sin_port = port;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409   <span class="keywordtype">int</span> socket = <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gadae462526ab01253d39e4a54346f56ca" title="create a producing or consuming UDP socket">CreateUdpSocket</a>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>,
<a name="l00410"></a>00410                                &amp;connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>); <span class="comment">/* the address is only needed for bind used if consuming */</span>
<a name="l00411"></a>00411   <span class="keywordflow">if</span> (socket == kEipInvalidSocket) {
<a name="l00412"></a>00412     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(
<a name="l00413"></a>00413       <span class="stringliteral">&quot;cannot create UDP socket in OpenPointToPointConnection\n&quot;</span>);
<a name="l00414"></a>00414     <span class="comment">/* *pa_pnExtendedError = 0x0315; miscellaneous*/</span>
<a name="l00415"></a>00415     <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00416"></a>00416   }
<a name="l00417"></a>00417   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] = socket;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a281f0a261db50e297593dd3383093fb0">00422</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a281f0a261db50e297593dd3383093fb0">OpenProducingMulticastConnection</a>(
<a name="l00423"></a>00423   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00424"></a>00424   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data) {
<a name="l00425"></a>00425   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *existing_connection_object =
<a name="l00426"></a>00426     <a class="code" href="../../d1/dbc/appcontype_8c.html#a7b838b128170044eb0d81371c9f0bb49" title="Check if there exists already an exclusive owner or listen only connection which produces the input a...">GetExistingProducerMulticastConnection</a>(
<a name="l00427"></a>00427       connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[1]);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429   <span class="keywordtype">int</span> j = 0; <span class="comment">/* allocate an unused sockaddr struct to use */</span>
<a name="l00430"></a>00430   <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#gafaae5be8de81c633ea4df46fa8b957e0" title="Data storage for the any CPF data Currently we are single threaded and need only one CPF at the time...">g_common_packet_format_data_item</a>.<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> == 0) { <span class="comment">/* it is not used yet */</span>
<a name="l00431"></a>00431     j = 0;
<a name="l00432"></a>00432   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#gafaae5be8de81c633ea4df46fa8b957e0" title="Data storage for the any CPF data Currently we are single threaded and need only one CPF at the time...">g_common_packet_format_data_item</a>.<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>
<a name="l00433"></a>00433              == 0) {
<a name="l00434"></a>00434     j = 1;
<a name="l00435"></a>00435   }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> =
<a name="l00438"></a>00438     <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440   <span class="keywordflow">if</span> (NULL == existing_connection_object) { <span class="comment">/* we are the first connection producing for the given Input Assembly */</span>
<a name="l00441"></a>00441     <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a9937b2aeb5fd393c7861e25f04c9f1c1">OpenMulticastConnection</a>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>,
<a name="l00442"></a>00442                                    connection_object,
<a name="l00443"></a>00443                                    common_packet_format_data);
<a name="l00444"></a>00444   } <span class="keywordflow">else</span> {
<a name="l00445"></a>00445     <span class="comment">/* we need to inform our originator on the correct connection id */</span>
<a name="l00446"></a>00446     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aa15e909827e498435ce848d6e98bf51e">cip_produced_connection_id</a> = existing_connection_object
<a name="l00447"></a>00447                                                     -&gt;
<a name="l00448"></a>00448                                                     cip_produced_connection_id;
<a name="l00449"></a>00449   }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <span class="comment">/* we have a connection reuse the data and the socket */</span>
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa1f0e2efd52935fd01bfece0fbead81fa49da9a89c43c187253492f976225db82">kConnectionTypeIoExclusiveOwner</a> == connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ada63f5853b16b3fa0d3c49b894157540">instance_type</a>) {
<a name="l00454"></a>00454     <span class="comment">/* exclusive owners take the socket and further manage the connection</span>
<a name="l00455"></a>00455 <span class="comment">     * especially in the case of time outs.</span>
<a name="l00456"></a>00456 <span class="comment">     */</span>
<a name="l00457"></a>00457     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00458"></a>00458       existing_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>];
<a name="l00459"></a>00459     existing_connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00460"></a>00460       kEipInvalidSocket;
<a name="l00461"></a>00461   } <span class="keywordflow">else</span> { <span class="comment">/* this connection will not produce the data */</span>
<a name="l00462"></a>00462     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00463"></a>00463       kEipInvalidSocket;
<a name="l00464"></a>00464   }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a8933e644c7191ea8f5a22401b2e6a6fa">length</a> = 16;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>.sin_family = AF_INET;
<a name="l00469"></a>00469   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>.sin_port = common_packet_format_data
<a name="l00470"></a>00470                                                -&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a>
<a name="l00471"></a>00471                                                  = htons(<a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a>);
<a name="l00472"></a>00472   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>.sin_addr.s_addr = common_packet_format_data
<a name="l00473"></a>00473                                                       -&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].
<a name="l00474"></a>00474                                                       sin_addr =
<a name="l00475"></a>00475                                                         <a class="code" href="../../dd/d20/ciptcpipinterface_8c.html#a3b13a18a3f6efcb8f2e651676096f4e5" title="#9 The multicast configuration for this device">g_multicast_configuration</a>
<a name="l00476"></a>00476                                                         .
<a name="l00477"></a>00477                                                         starting_multicast_address;
<a name="l00478"></a>00478   memset(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#abaf556494b9fea3137c6c45522ab9bda">nasin_zero</a>, 0, 8);
<a name="l00479"></a>00479   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a> = htons(AF_INET);
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00491"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a9937b2aeb5fd393c7861e25f04c9f1c1">00491</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a9937b2aeb5fd393c7861e25f04c9f1c1">OpenMulticastConnection</a>(
<a name="l00492"></a>00492   <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42" title="Communication direction of an UDP socket; consuming is receiver, producing is sender.">UdpCommuncationDirection</a> direction,
<a name="l00493"></a>00493   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00494"></a>00494   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data) {
<a name="l00495"></a>00495   <span class="keywordtype">int</span> j = -1;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <span class="keywordtype">int</span> address_info_item_which_contains_o_to_t = -1;
<a name="l00498"></a>00498   <span class="keywordtype">int</span> address_info_item_which_contains_t_to_o = -1;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500   <span class="keywordflow">if</span>(<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a93851549b6af1ed796409633e8071623">kCipItemIdSocketAddressInfoOriginatorToTarget</a>
<a name="l00501"></a>00501      == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00502"></a>00502     address_info_item_which_contains_o_to_t = 0;
<a name="l00503"></a>00503   } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a93851549b6af1ed796409633e8071623">kCipItemIdSocketAddressInfoOriginatorToTarget</a>
<a name="l00504"></a>00504             == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00505"></a>00505     address_info_item_which_contains_o_to_t = 1;
<a name="l00506"></a>00506   } <span class="keywordflow">else</span> {
<a name="l00507"></a>00507     <a class="code" href="../../d1/d1b/trace_8h.html#a9a8a4741005c175e598afc162f68982a">OPENER_TRACE_INFO</a>(<span class="stringliteral">&quot;No O-&gt;T Sockaddr info available\n&quot;</span>);
<a name="l00508"></a>00508   }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510   <span class="keywordflow">if</span>(<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>
<a name="l00511"></a>00511      == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00512"></a>00512     address_info_item_which_contains_t_to_o = 0;
<a name="l00513"></a>00513   } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>
<a name="l00514"></a>00514             == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00515"></a>00515     address_info_item_which_contains_t_to_o = 1;
<a name="l00516"></a>00516   } <span class="keywordflow">else</span> {
<a name="l00517"></a>00517     <a class="code" href="../../d1/d1b/trace_8h.html#a9a8a4741005c175e598afc162f68982a">OPENER_TRACE_INFO</a>(<span class="stringliteral">&quot;No T-&gt;O Sockaddr info available\n&quot;</span>);
<a name="l00518"></a>00518   }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520   <span class="keywordflow">if</span>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a> == direction) {
<a name="l00521"></a>00521     <span class="comment">//OPENER_ASSERT(-1 != address_info_item_which_contains_o_to_t);</span>
<a name="l00522"></a>00522     j = address_info_item_which_contains_o_to_t;
<a name="l00523"></a>00523   }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525   <span class="keywordflow">if</span>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a> == direction) {
<a name="l00526"></a>00526     <span class="comment">//OPENER_ASSERT(-1 != address_info_item_which_contains_o_to_t);</span>
<a name="l00527"></a>00527     j = address_info_item_which_contains_t_to_o;
<a name="l00528"></a>00528   }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530   <span class="comment">/*****************/</span>
<a name="l00531"></a>00531 
<a name="l00532"></a>00532   <span class="keywordflow">if</span> (-1 == j) {
<a name="l00533"></a>00533     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(
<a name="l00534"></a>00534       <span class="stringliteral">&quot;no suitable addr info item available / O-&gt;T: %d, T-&gt;O: %d, Selector: %d, direction: %d\n&quot;</span>,
<a name="l00535"></a>00535       address_info_item_which_contains_o_to_t,
<a name="l00536"></a>00536       address_info_item_which_contains_t_to_o,
<a name="l00537"></a>00537       j,
<a name="l00538"></a>00538       direction);
<a name="l00539"></a>00539     <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00540"></a>00540   }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542   <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a> ==
<a name="l00543"></a>00543       common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {                                                  <span class="comment">/* we are using an unused item initialize it with the default multicast address */</span>
<a name="l00544"></a>00544     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a> = htons(
<a name="l00545"></a>00545       AF_INET);
<a name="l00546"></a>00546     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a> = htons(
<a name="l00547"></a>00547       <a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a>);
<a name="l00548"></a>00548     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a46921af5bef9ee04546194f8d19d3163">sin_addr</a> =
<a name="l00549"></a>00549       <a class="code" href="../../dd/d20/ciptcpipinterface_8c.html#a3b13a18a3f6efcb8f2e651676096f4e5" title="#9 The multicast configuration for this device">g_multicast_configuration</a>.<a class="code" href="../../db/dd7/structmulticast__address__configuration.html#a983b98b7087072214bc4fc803b938df3">starting_multicast_address</a>;
<a name="l00550"></a>00550     memset(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#abaf556494b9fea3137c6c45522ab9bda">nasin_zero</a>, 0, 8);
<a name="l00551"></a>00551     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a8933e644c7191ea8f5a22401b2e6a6fa">length</a> = 16;
<a name="l00552"></a>00552   }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   <span class="keywordflow">if</span> (htons(AF_INET)
<a name="l00555"></a>00555       != common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a>) {
<a name="l00556"></a>00556     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(
<a name="l00557"></a>00557       <span class="stringliteral">&quot;Sockaddr Info Item with wrong sin family value received\n&quot;</span>);
<a name="l00558"></a>00558     <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00559"></a>00559   }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561   <span class="comment">/* allocate an unused sockaddr struct to use */</span>
<a name="l00562"></a>00562   <span class="keyword">struct </span>sockaddr_in socket_address = {0};
<a name="l00563"></a>00563   socket_address.sin_family = ntohs(
<a name="l00564"></a>00564     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a>);
<a name="l00565"></a>00565   socket_address.sin_addr.s_addr =
<a name="l00566"></a>00566     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a46921af5bef9ee04546194f8d19d3163">sin_addr</a>;
<a name="l00567"></a>00567   socket_address.sin_port = common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j]
<a name="l00568"></a>00568                             .<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a>;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570   <span class="keywordtype">int</span> socket = <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gadae462526ab01253d39e4a54346f56ca" title="create a producing or consuming UDP socket">CreateUdpSocket</a>(direction, &amp;socket_address); <span class="comment">/* the address is only needed for bind used if consuming */</span>
<a name="l00571"></a>00571   <span class="keywordflow">if</span> (socket == kEipInvalidSocket) {
<a name="l00572"></a>00572     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;cannot create UDP socket in OpenMulticastConnection\n&quot;</span>);
<a name="l00573"></a>00573     <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00574"></a>00574   }
<a name="l00575"></a>00575   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[direction] = socket;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577   <span class="keywordflow">if</span> (direction == <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>) {
<a name="l00578"></a>00578     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> =
<a name="l00579"></a>00579       <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a93851549b6af1ed796409633e8071623">kCipItemIdSocketAddressInfoOriginatorToTarget</a>;
<a name="l00580"></a>00580     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a122616a0d743a67d5333a79c57ba50b8">originator_address</a> = socket_address;
<a name="l00581"></a>00581   } <span class="keywordflow">else</span> {
<a name="l00582"></a>00582     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> =
<a name="l00583"></a>00583       <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>;
<a name="l00584"></a>00584     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a> = socket_address;
<a name="l00585"></a>00585   }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00588"></a>00588 }
<a name="l00589"></a>00589 
<a name="l00590"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a092519d4bb79e85405f3bae92391ab71">00590</a> <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a092519d4bb79e85405f3bae92391ab71">HandleConfigData</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>) {
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <a class="code" href="../../da/d8e/structcip__class.html" title="Class is a subclass of Instance.">CipClass</a> *<span class="keyword">const</span> assembly_class = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga98bd609c80ece316406363575b4a89ea" title="Get a pointer to a CIP object with given class code.">GetCipClass</a>(kCipAssemblyClassCode);
<a name="l00593"></a>00593   <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> connection_manager_status = 0;
<a name="l00594"></a>00594   <a class="code" href="../../d5/dc5/structcip__instance.html">CipInstance</a> *config_instance = <a class="code" href="../../d2/dc9/group__CIP__API.html#gaa50395aca91b378c297d6ad919df210e" title="Get a pointer to an instance.">GetCipInstance</a>(
<a name="l00595"></a>00595     assembly_class, connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[2]);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597   <span class="keywordflow">if</span> (0 != <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a>) {
<a name="l00598"></a>00598     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/dbc/appcontype_8c.html#aea7e180dc280ec82f06282864f84097a" title="Check if there is an established connection that uses the same config point.">ConnectionWithSameConfigPointExists</a>(
<a name="l00599"></a>00599            connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[
<a name="l00600"></a>00600              <a class="code" href="../../df/d03/cipioconnection_8c.html#a40ed6631834d2bde61a033499870a0af">kConnectionPointConfig</a>]) ) {                                               <span class="comment">/* there is a connected connection with the same config point</span>
<a name="l00601"></a>00601 <span class="comment">                                                                                         * we have to have the same data as already present in the config point*/</span>
<a name="l00602"></a>00602       <a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *attribute_three = (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) <a class="code" href="../../d2/dc9/group__CIP__API.html#ga5a14c8d76acacb09312b709bb0a76265" title="Get a pointer to an instance&#39;s attribute.">GetCipAttribute</a>(
<a name="l00603"></a>00603         config_instance,
<a name="l00604"></a>00604         3)
<a name="l00605"></a>00605                                       -&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a>;
<a name="l00606"></a>00606       <span class="keywordflow">if</span> (attribute_three-&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#a2fc468bacd1d1300da4286bb838b7f7b">length</a> != <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a>) {
<a name="l00607"></a>00607         connection_manager_status =
<a name="l00608"></a>00608           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a81369fa2ff6c7f2165f3876c6eac1a03">kConnectionManagerExtendedStatusCodeErrorOwnershipConflict</a>;
<a name="l00609"></a>00609         <a class="code" href="../../d1/d1b/trace_8h.html#a9a8a4741005c175e598afc162f68982a">OPENER_TRACE_INFO</a>(
<a name="l00610"></a>00610           <span class="stringliteral">&quot;Hit an Ownership conflict in cipioconnection.c occurrence 1&quot;</span>);
<a name="l00611"></a>00611       } <span class="keywordflow">else</span> {
<a name="l00612"></a>00612         <span class="comment">/*FIXME check if this is correct */</span>
<a name="l00613"></a>00613         <span class="keywordflow">if</span> ( memcmp(attribute_three-&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#ad1f95b3da0adfd2aeafd5db1d415a6b9">data</a>, <a class="code" href="../../df/d03/cipioconnection_8c.html#a534c0a24266039f7ced0d36b7c5496bc">g_config_data_buffer</a>,
<a name="l00614"></a>00614                     <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a>) ) {
<a name="l00615"></a>00615           connection_manager_status =
<a name="l00616"></a>00616             <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a81369fa2ff6c7f2165f3876c6eac1a03">kConnectionManagerExtendedStatusCodeErrorOwnershipConflict</a>;
<a name="l00617"></a>00617           <a class="code" href="../../d1/d1b/trace_8h.html#a9a8a4741005c175e598afc162f68982a">OPENER_TRACE_INFO</a>(
<a name="l00618"></a>00618             <span class="stringliteral">&quot;Hit an Ownership conflict in cipioconnection.c occurrence 2&quot;</span>);
<a name="l00619"></a>00619         }
<a name="l00620"></a>00620       }
<a name="l00621"></a>00621     } <span class="keywordflow">else</span> {
<a name="l00622"></a>00622       <span class="comment">/* put the data on the configuration assembly object with the current</span>
<a name="l00623"></a>00623 <span class="comment">         design this can be done rather efficiently */</span>
<a name="l00624"></a>00624       <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>
<a name="l00625"></a>00625            != <a class="code" href="../../df/d2e/cipassembly_8c.html#a5dc25129faf75858c0aeaa88ea8d9490" title="notify an Assembly object that data has been received for it.">NotifyAssemblyConnectedDataReceived</a>(config_instance,
<a name="l00626"></a>00626                                                   <a class="code" href="../../df/d03/cipioconnection_8c.html#a534c0a24266039f7ced0d36b7c5496bc">g_config_data_buffer</a>,
<a name="l00627"></a>00627                                                   <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a>) ) {
<a name="l00628"></a>00628         <a class="code" href="../../d1/d1b/trace_8h.html#aa1b39db9477c48695273170aff3c3a7a">OPENER_TRACE_WARN</a>(<span class="stringliteral">&quot;Configuration data was invalid\n&quot;</span>);
<a name="l00629"></a>00629         connection_manager_status =
<a name="l00630"></a>00630           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a27cf9777eb05383c79d0a8064f00db90">kConnectionManagerExtendedStatusCodeInvalidConfigurationApplicationPath</a>;
<a name="l00631"></a>00631       }
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633   }
<a name="l00634"></a>00634   <span class="keywordflow">return</span> connection_manager_status;
<a name="l00635"></a>00635 }
<a name="l00636"></a>00636 
<a name="l00637"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#adb77dcdc1545600764cd212783f5c4e2">00637</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#adb77dcdc1545600764cd212783f5c4e2">CloseIoConnection</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>) {
<a name="l00638"></a>00638 
<a name="l00639"></a>00639   <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gac9c9ad2c2254b783e7b447bd84eba8c0" title="Inform the application on changes occurred for a connection.">CheckIoConnectionEvent</a>(connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[
<a name="l00640"></a>00640                            <a class="code" href="../../df/d03/cipioconnection_8c.html#aabcddf69bfc448fff15044d61dbf9b65">kConnectionPointConsumer</a>],
<a name="l00641"></a>00641                          connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[
<a name="l00642"></a>00642                            <a class="code" href="../../df/d03/cipioconnection_8c.html#ac91e927d82030bc35f3f54cb3cf21452">kConnectionPointProducer</a>],
<a name="l00643"></a>00643                          <a class="code" href="../../df/d28/ciptypes_8h.html#a1a7498137431124c4dde66e95095c2d2aef7d80152c2d6e1a5e7f64bf51801374">kIoConnectionEventClosed</a>);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645   <span class="keywordflow">if</span> ( (<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa1f0e2efd52935fd01bfece0fbead81fa49da9a89c43c187253492f976225db82">kConnectionTypeIoExclusiveOwner</a> == connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ada63f5853b16b3fa0d3c49b894157540">instance_type</a>)
<a name="l00646"></a>00646        || (<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa1f0e2efd52935fd01bfece0fbead81fa1d880893638e59b11e4a2874c20ff5c3">kConnectionTypeIoInputOnly</a> == connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ada63f5853b16b3fa0d3c49b894157540">instance_type</a>) ) {
<a name="l00647"></a>00647     <span class="keywordflow">if</span> ( ( <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4ca8ee5c4f2e59cc457d3981e241811c6c7">kForwardOpenConnectionTypeMulticastConnection</a>
<a name="l00648"></a>00648            == (connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a8ccf723e8dce62eb578a046fd35a774f">t_to_o_network_connection_parameter</a>
<a name="l00649"></a>00649                &amp; <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4ca8ee5c4f2e59cc457d3981e241811c6c7">kForwardOpenConnectionTypeMulticastConnection</a>) )
<a name="l00650"></a>00650          &amp;&amp; (kEipInvalidSocket
<a name="l00651"></a>00651              != connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>]) )
<a name="l00652"></a>00652     {
<a name="l00653"></a>00653       <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *next_non_control_master_connection =
<a name="l00654"></a>00654         <a class="code" href="../../d1/dbc/appcontype_8c.html#a1cbf4348c1bb5f1949d7ed38c58b2f27" title="check if there exists an producing multicast exclusive owner or listen only connection that should pr...">GetNextNonControlMasterConnection</a>(
<a name="l00655"></a>00655           connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[
<a name="l00656"></a>00656             <a class="code" href="../../df/d03/cipioconnection_8c.html#ac91e927d82030bc35f3f54cb3cf21452">kConnectionPointProducer</a>]);
<a name="l00657"></a>00657       <span class="keywordflow">if</span> (NULL != next_non_control_master_connection) {
<a name="l00658"></a>00658         next_non_control_master_connection-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[
<a name="l00659"></a>00659           <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00660"></a>00660           connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>];
<a name="l00661"></a>00661         memcpy( &amp;(next_non_control_master_connection-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>),
<a name="l00662"></a>00662                 &amp;(connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>),
<a name="l00663"></a>00663                 <span class="keyword">sizeof</span>(next_non_control_master_connection-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>) );
<a name="l00664"></a>00664         next_non_control_master_connection-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aa31634b17dcfdd7d98ad8b4219558dbf">eip_level_sequence_count_producing</a>
<a name="l00665"></a>00665           =
<a name="l00666"></a>00666             connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aa31634b17dcfdd7d98ad8b4219558dbf">eip_level_sequence_count_producing</a>;
<a name="l00667"></a>00667         next_non_control_master_connection-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a3bdc60cec812eb1fa09d731971c28c59">sequence_count_producing</a> =
<a name="l00668"></a>00668           connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a3bdc60cec812eb1fa09d731971c28c59">sequence_count_producing</a>;
<a name="l00669"></a>00669         connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00670"></a>00670           kEipInvalidSocket;
<a name="l00671"></a>00671         next_non_control_master_connection-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a8ff49ae39efff1f6e82d66bca01f995b">transmission_trigger_timer</a> =
<a name="l00672"></a>00672           connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a8ff49ae39efff1f6e82d66bca01f995b">transmission_trigger_timer</a>;
<a name="l00673"></a>00673       } <span class="keywordflow">else</span> { <span class="comment">/* this was the last master connection close all listen only connections listening on the port */</span>
<a name="l00674"></a>00674         <a class="code" href="../../d1/dbc/appcontype_8c.html#a67233ebfb6ba7952669a197a4cf21126" title="Close all connection producing the same input and have the same type (i.e., listen only or input only...">CloseAllConnectionsForInputWithSameType</a>(
<a name="l00675"></a>00675           connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[
<a name="l00676"></a>00676             <a class="code" href="../../df/d03/cipioconnection_8c.html#ac91e927d82030bc35f3f54cb3cf21452">kConnectionPointProducer</a>],
<a name="l00677"></a>00677           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa1f0e2efd52935fd01bfece0fbead81fae26e447506c01160477cb3de20a1e438">kConnectionTypeIoListenOnly</a>);
<a name="l00678"></a>00678       }
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680   }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682   <a class="code" href="../../df/d03/cipioconnection_8c.html#ab63a9cebd7f44ee474ac1fd446d5bc66" title="close the communication channels of the given connection and remove it from the active connections li...">CloseCommunicationChannelsAndRemoveFromActiveConnectionsList</a>(
<a name="l00683"></a>00683     connection_object);
<a name="l00684"></a>00684 }
<a name="l00685"></a>00685 
<a name="l00686"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a043e7b682698cb5a50ced76b6ce10293">00686</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a043e7b682698cb5a50ced76b6ce10293">HandleIoConnectionTimeOut</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>) {
<a name="l00687"></a>00687   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *next_non_control_master_connection;
<a name="l00688"></a>00688   <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gac9c9ad2c2254b783e7b447bd84eba8c0" title="Inform the application on changes occurred for a connection.">CheckIoConnectionEvent</a>(connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[0],
<a name="l00689"></a>00689                          connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[1],
<a name="l00690"></a>00690                          <a class="code" href="../../df/d28/ciptypes_8h.html#a1a7498137431124c4dde66e95095c2d2a91f5cbaf05e3e1e95b9c262a851ae931">kIoConnectionEventTimedOut</a>);
<a name="l00691"></a>00691 
<a name="l00692"></a>00692   <span class="keywordflow">if</span> ( <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4ca8ee5c4f2e59cc457d3981e241811c6c7">kForwardOpenConnectionTypeMulticastConnection</a>
<a name="l00693"></a>00693        == (connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a8ccf723e8dce62eb578a046fd35a774f">t_to_o_network_connection_parameter</a>
<a name="l00694"></a>00694            &amp; <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4ca8ee5c4f2e59cc457d3981e241811c6c7">kForwardOpenConnectionTypeMulticastConnection</a>) ) {
<a name="l00695"></a>00695     <span class="keywordflow">switch</span> (connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ada63f5853b16b3fa0d3c49b894157540">instance_type</a>) {
<a name="l00696"></a>00696       <span class="keywordflow">case</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa1f0e2efd52935fd01bfece0fbead81fa49da9a89c43c187253492f976225db82">kConnectionTypeIoExclusiveOwner</a>:
<a name="l00697"></a>00697         <a class="code" href="../../d1/dbc/appcontype_8c.html#a67233ebfb6ba7952669a197a4cf21126" title="Close all connection producing the same input and have the same type (i.e., listen only or input only...">CloseAllConnectionsForInputWithSameType</a>(
<a name="l00698"></a>00698           connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[1],
<a name="l00699"></a>00699           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa1f0e2efd52935fd01bfece0fbead81fa1d880893638e59b11e4a2874c20ff5c3">kConnectionTypeIoInputOnly</a>);
<a name="l00700"></a>00700         <a class="code" href="../../d1/dbc/appcontype_8c.html#a67233ebfb6ba7952669a197a4cf21126" title="Close all connection producing the same input and have the same type (i.e., listen only or input only...">CloseAllConnectionsForInputWithSameType</a>(
<a name="l00701"></a>00701           connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[1],
<a name="l00702"></a>00702           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa1f0e2efd52935fd01bfece0fbead81fae26e447506c01160477cb3de20a1e438">kConnectionTypeIoListenOnly</a>);
<a name="l00703"></a>00703         <span class="keywordflow">break</span>;
<a name="l00704"></a>00704       <span class="keywordflow">case</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa1f0e2efd52935fd01bfece0fbead81fa1d880893638e59b11e4a2874c20ff5c3">kConnectionTypeIoInputOnly</a>:
<a name="l00705"></a>00705         <span class="keywordflow">if</span> (kEipInvalidSocket
<a name="l00706"></a>00706             != connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>]) { <span class="comment">/* we are the controlling input only connection find a new controller*/</span>
<a name="l00707"></a>00707           next_non_control_master_connection =
<a name="l00708"></a>00708             <a class="code" href="../../d1/dbc/appcontype_8c.html#a1cbf4348c1bb5f1949d7ed38c58b2f27" title="check if there exists an producing multicast exclusive owner or listen only connection that should pr...">GetNextNonControlMasterConnection</a>(
<a name="l00709"></a>00709               connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[1]);
<a name="l00710"></a>00710           <span class="keywordflow">if</span> (NULL != next_non_control_master_connection) {
<a name="l00711"></a>00711             next_non_control_master_connection-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[
<a name="l00712"></a>00712               <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00713"></a>00713               connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>];
<a name="l00714"></a>00714             connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00715"></a>00715               kEipInvalidSocket;
<a name="l00716"></a>00716             next_non_control_master_connection-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a8ff49ae39efff1f6e82d66bca01f995b">transmission_trigger_timer</a> =
<a name="l00717"></a>00717               connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a8ff49ae39efff1f6e82d66bca01f995b">transmission_trigger_timer</a>;
<a name="l00718"></a>00718           } <span class="keywordflow">else</span> { <span class="comment">/* this was the last master connection close all listen only connections listening on the port */</span>
<a name="l00719"></a>00719             <a class="code" href="../../d1/dbc/appcontype_8c.html#a67233ebfb6ba7952669a197a4cf21126" title="Close all connection producing the same input and have the same type (i.e., listen only or input only...">CloseAllConnectionsForInputWithSameType</a>(
<a name="l00720"></a>00720               connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a7ea92b8fc46bb305035ed3547516e0a7">connection_path</a>.<a class="code" href="../../dd/d06/structCipConnectionPath.html#a449b31ee6e9f52fe770e50085899c3a4">connection_point</a>[1],
<a name="l00721"></a>00721               <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa1f0e2efd52935fd01bfece0fbead81fae26e447506c01160477cb3de20a1e438">kConnectionTypeIoListenOnly</a>);
<a name="l00722"></a>00722           }
<a name="l00723"></a>00723         }
<a name="l00724"></a>00724         <span class="keywordflow">break</span>;
<a name="l00725"></a>00725       <span class="keywordflow">default</span>:
<a name="l00726"></a>00726         <span class="keywordflow">break</span>;
<a name="l00727"></a>00727     }
<a name="l00728"></a>00728   }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730   <a class="code" href="../../dd/d1b/POSIX_2sample__application_2opener__user__conf_8h.html#a7b5e7d71f666ba97788b35be1617c40a">OPENER_ASSERT</a>(NULL != connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a51af396f09a2874cecd1d463c85e2a34">connection_close_function</a>);
<a name="l00731"></a>00731   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a51af396f09a2874cecd1d463c85e2a34">connection_close_function</a>(connection_object);
<a name="l00732"></a>00732 }
<a name="l00733"></a>00733 
<a name="l00734"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a41f8d71772b5defa587ac0da6124cc47">00734</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a41f8d71772b5defa587ac0da6124cc47" title="Send the data from the produced CIP Object of the connection via the socket of the connection object ...">SendConnectedData</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>) {
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   <span class="comment">/* TODO think of adding an own send buffer to each connection object in order to preset up the whole message on connection opening and just change the variable data items e.g., sequence number */</span>
<a name="l00737"></a>00737 
<a name="l00738"></a>00738   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data =
<a name="l00739"></a>00739     &amp;<a class="code" href="../../d4/d91/group__ENCAP.html#gafaae5be8de81c633ea4df46fa8b957e0" title="Data storage for the any CPF data Currently we are single threaded and need only one CPF at the time...">g_common_packet_format_data_item</a>;                                                      <span class="comment">/* TODO think on adding a CPF data item to the S_CIP_ConnectionObject in order to remove the code here or even better allocate memory in the connection object for storing the message to send and just change the application data*/</span>
<a name="l00740"></a>00740 
<a name="l00741"></a>00741   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aa31634b17dcfdd7d98ad8b4219558dbf">eip_level_sequence_count_producing</a>++;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   <span class="comment">/* assembleCPFData */</span>
<a name="l00744"></a>00744   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a7ff1108c27f9ebe1d69305311c6b234b">item_count</a> = 2;
<a name="l00745"></a>00745   <span class="keywordflow">if</span> ( (connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aee393bffe6bd92fb313db48832665254">transport_type_class_trigger</a> &amp; 0x0F) != 0 ) { <span class="comment">/* use Sequenced Address Items if not Connection Class 0 */</span>
<a name="l00746"></a>00746     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#a9b3cf54385b7e3db0c41d4d394c2d465">type_id</a> =
<a name="l00747"></a>00747       <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a21abefabf9f64dba055671507015f2b1">kCipItemIdSequencedAddressItem</a>;
<a name="l00748"></a>00748     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#a8651f8610143cd0ef830abdc1fcf00b2">length</a> = 8;
<a name="l00749"></a>00749     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#ae405cdded64b36b5bbad607ea251865a">data</a>.<a class="code" href="../../d9/da2/structAddressData.html#a41d4480ab2d89c04cd9211586be88ba5">sequence_number</a> =
<a name="l00750"></a>00750       connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aa31634b17dcfdd7d98ad8b4219558dbf">eip_level_sequence_count_producing</a>;
<a name="l00751"></a>00751   } <span class="keywordflow">else</span> {
<a name="l00752"></a>00752     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#a9b3cf54385b7e3db0c41d4d394c2d465">type_id</a> =
<a name="l00753"></a>00753       <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a0adf8007a319941f3aaa7d9624025c0f">kCipItemIdConnectionAddress</a>;
<a name="l00754"></a>00754     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#a8651f8610143cd0ef830abdc1fcf00b2">length</a> = 4;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756   }
<a name="l00757"></a>00757   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#ae405cdded64b36b5bbad607ea251865a">data</a>.<a class="code" href="../../d9/da2/structAddressData.html#a955e0fc2a462a58b78f0da83df66a307">connection_identifier</a> =
<a name="l00758"></a>00758     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aa15e909827e498435ce848d6e98bf51e">cip_produced_connection_id</a>;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#acf4b53bdfe8766830d313e9c7e1cf5dc">type_id</a> = <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a8761662aa0838fb723f8696e9ea4e217">kCipItemIdConnectedDataItem</a>;
<a name="l00761"></a>00761 
<a name="l00762"></a>00762   <a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *producing_instance_attributes =
<a name="l00763"></a>00763     (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ab486fb828cb85f57c53abea69ad9faff">producing_instance</a>-&gt;<a class="code" href="../../d5/dc5/structcip__instance.html#ada5c4109b95cb6635f4aa32a2e6d74bf">attributes</a>-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a>;
<a name="l00764"></a>00764   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a> = 0;
<a name="l00765"></a>00765 
<a name="l00766"></a>00766   <span class="comment">/* notify the application that data will be sent immediately after the call */</span>
<a name="l00767"></a>00767   if ( <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#ga098272a8ae10facf3086c5c82a0080db" title="Inform the application that the data of an assembly object will be sent.">BeforeAssemblyDataSend</a>(connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ab486fb828cb85f57c53abea69ad9faff">producing_instance</a>) ) {
<a name="l00768"></a>00768     <span class="comment">/* the data has changed increase sequence counter */</span>
<a name="l00769"></a>00769     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a3bdc60cec812eb1fa09d731971c28c59">sequence_count_producing</a>++;
<a name="l00770"></a>00770   }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772   <span class="comment">/* set AddressInfo Items to invalid Type */</span>
<a name="l00773"></a>00773   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> = 0;
<a name="l00774"></a>00774   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> = 0;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776   <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> reply_length = <a class="code" href="../../d4/d91/group__ENCAP.html#gad61fa4f84989cf27086d57557ad552c4">AssembleIOMessage</a>(common_packet_format_data,
<a name="l00777"></a>00777                                              &amp;<a class="code" href="../../d2/d3d/cipcommon_8c.html#a5bd888b31f309543df6dc57652d2ac48">g_message_data_reply_buffer</a>[0]);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779   <a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *message_data_reply_buffer =
<a name="l00780"></a>00780     &amp;<a class="code" href="../../d2/d3d/cipcommon_8c.html#a5bd888b31f309543df6dc57652d2ac48">g_message_data_reply_buffer</a>[reply_length - 2];
<a name="l00781"></a>00781   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a> = producing_instance_attributes
<a name="l00782"></a>00782                                                 -&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#a2fc468bacd1d1300da4286bb838b7f7b">length</a>;
<a name="l00783"></a>00783   <span class="keywordflow">if</span> (kOpenerProducedDataHasRunIdleHeader) {
<a name="l00784"></a>00784     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a> += 4;
<a name="l00785"></a>00785   }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787   <span class="keywordflow">if</span> ( (connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aee393bffe6bd92fb313db48832665254">transport_type_class_trigger</a> &amp; 0x0F) == 1 ) {
<a name="l00788"></a>00788     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a> += 2;
<a name="l00789"></a>00789     <a class="code" href="../../d4/d91/group__ENCAP.html#gae689aac2a85bf49fb356ec94c8800799" title="converts UINT16 data from host to little endian an writes it to buffer.">AddIntToMessage</a>(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a>,
<a name="l00790"></a>00790                     &amp;message_data_reply_buffer);
<a name="l00791"></a>00791     <a class="code" href="../../d4/d91/group__ENCAP.html#gae689aac2a85bf49fb356ec94c8800799" title="converts UINT16 data from host to little endian an writes it to buffer.">AddIntToMessage</a>(connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a3bdc60cec812eb1fa09d731971c28c59">sequence_count_producing</a>,
<a name="l00792"></a>00792                     &amp;message_data_reply_buffer);
<a name="l00793"></a>00793   } <span class="keywordflow">else</span> {
<a name="l00794"></a>00794     <a class="code" href="../../d4/d91/group__ENCAP.html#gae689aac2a85bf49fb356ec94c8800799" title="converts UINT16 data from host to little endian an writes it to buffer.">AddIntToMessage</a>(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a>,
<a name="l00795"></a>00795                     &amp;message_data_reply_buffer);
<a name="l00796"></a>00796   }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798   <span class="keywordflow">if</span> (kOpenerProducedDataHasRunIdleHeader) {
<a name="l00799"></a>00799     <a class="code" href="../../d4/d91/group__ENCAP.html#gaafc3c9e3ff582c9b7e438ae2b1fdf822" title="Converts UINT32 data from host to little endian and writes it to buffer.">AddDintToMessage</a>( <a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">g_run_idle_state</a>, &amp;(message_data_reply_buffer) );
<a name="l00800"></a>00800   }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802   memcpy(message_data_reply_buffer, producing_instance_attributes-&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#ad1f95b3da0adfd2aeafd5db1d415a6b9">data</a>,
<a name="l00803"></a>00803          producing_instance_attributes-&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#a2fc468bacd1d1300da4286bb838b7f7b">length</a>);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805   reply_length += common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a>;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807   <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gad1d5f56b277bf8b4ffc431e5b0523518" title="create a producing or consuming UDP socket">SendUdpData</a>(
<a name="l00808"></a>00808     &amp;connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#a32b8fe01a538f765d0cce564f705c2ea">remote_address</a>,
<a name="l00809"></a>00809     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>],
<a name="l00810"></a>00810     &amp;<a class="code" href="../../d2/d3d/cipcommon_8c.html#a5bd888b31f309543df6dc57652d2ac48">g_message_data_reply_buffer</a>[0], reply_length);
<a name="l00811"></a>00811 }
<a name="l00812"></a>00812 
<a name="l00813"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#aca3c7cb7fc5d8d3f86698cb4c31f108f">00813</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#aca3c7cb7fc5d8d3f86698cb4c31f108f">HandleReceivedIoConnectionData</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>,
<a name="l00814"></a>00814                                          <span class="keyword">const</span> <a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *data,
<a name="l00815"></a>00815                                          <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> data_length) {
<a name="l00816"></a>00816 
<a name="l00817"></a>00817   <span class="comment">/* check class 1 sequence number*/</span>
<a name="l00818"></a>00818   <span class="keywordflow">if</span> ( (connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aee393bffe6bd92fb313db48832665254">transport_type_class_trigger</a> &amp; 0x0F) == 1 ) {
<a name="l00819"></a>00819     <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> sequence_buffer = <a class="code" href="../../d4/d91/group__ENCAP.html#ga70322f970709ca9c9a1a1d474cfe2302" title="Reads EIP_UINT16 from *buffer and converts little endian to host.">GetIntFromMessage</a>( &amp;(data) );
<a name="l00820"></a>00820     <span class="keywordflow">if</span> ( <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa90301ce80009301ef74637f50a79e69" title="similar macros for comparing 16 bit sequence numbers  SEQ_LEQ16(a, b) Checks if sequence number a is ...">SEQ_LEQ16</a>(sequence_buffer,
<a name="l00821"></a>00821                    connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ad6c06f4b33c7bea685145806c86d2c3f">sequence_count_consuming</a>) ) {
<a name="l00822"></a>00822       <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>; <span class="comment">/* no new data for the assembly */</span>
<a name="l00823"></a>00823     }
<a name="l00824"></a>00824     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#ad6c06f4b33c7bea685145806c86d2c3f">sequence_count_consuming</a> = sequence_buffer;
<a name="l00825"></a>00825     data_length -= 2;
<a name="l00826"></a>00826   }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828   <span class="keywordflow">if</span> (data_length &gt; 0) {
<a name="l00829"></a>00829     <span class="comment">/* we have no heartbeat connection */</span>
<a name="l00830"></a>00830     <span class="keywordflow">if</span> (kOpenerConsumedDataHasRunIdleHeader) {
<a name="l00831"></a>00831       <a class="code" href="../../d7/d69/typedefs_8h.html#abf2dd49262551294eb990ef8746a2767">EipUint32</a> nRunIdleBuf = <a class="code" href="../../d4/d91/group__ENCAP.html#ga668f92389ee06510864585b97955f6f8" title="Reads EIP_UINT32 from *buffer and converts little endian to host.">GetDintFromMessage</a>( &amp;(data) );
<a name="l00832"></a>00832       <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">g_run_idle_state</a> != nRunIdleBuf) {
<a name="l00833"></a>00833         <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#ga63bf35df0c11815a8a59d8a68ac4b569" title="Inform the application that the Run/Idle State has been changed by the originator.">RunIdleChanged</a>(nRunIdleBuf);
<a name="l00834"></a>00834       }
<a name="l00835"></a>00835       <a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">g_run_idle_state</a> = nRunIdleBuf;
<a name="l00836"></a>00836       data_length -= 4;
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <span class="keywordflow">if</span> (<a class="code" href="../../df/d2e/cipassembly_8c.html#a5dc25129faf75858c0aeaa88ea8d9490" title="notify an Assembly object that data has been received for it.">NotifyAssemblyConnectedDataReceived</a>(
<a name="l00840"></a>00840           connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#aef7f726017a6d89235c9ee8c0ef98d71">consuming_instance</a>, (<a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *<span class="keyword">const</span>)data,
<a name="l00841"></a>00841           data_length) != 0) {
<a name="l00842"></a>00842       <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844   }
<a name="l00845"></a>00845   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00846"></a>00846 }
<a name="l00847"></a>00847 
<a name="l00848"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#adbb39670c736df4ef89589a3b4e4df4e">00848</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#adbb39670c736df4ef89589a3b4e4df4e" title="Take the data given in the connection object structure and open the necessary communication channels...">OpenCommunicationChannels</a>(<a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>) {
<a name="l00849"></a>00849 
<a name="l00850"></a>00850   <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> eip_status = <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00851"></a>00851   <span class="comment">/*get pointer to the CPF data, currently we have just one global instance of the struct. This may change in the future*/</span>
<a name="l00852"></a>00852   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data =
<a name="l00853"></a>00853     &amp;<a class="code" href="../../d4/d91/group__ENCAP.html#gafaae5be8de81c633ea4df46fa8b957e0" title="Data storage for the any CPF data Currently we are single threaded and need only one CPF at the time...">g_common_packet_format_data_item</a>;
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4c" title="Connection Type constants of the Forward Open service request Indicates either a.">ForwardOpenConnectionType</a> originator_to_target_connection_type =
<a name="l00856"></a>00856     <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#abe98e638bb3ac01dc06d7d944a1f30bf" title="returns the connection type of the supplied network connection parameter">GetConnectionType</a>(connection_object
<a name="l00857"></a>00857                       -&gt;
<a name="l00858"></a>00858                       o_to_t_network_connection_parameter);
<a name="l00859"></a>00859 
<a name="l00860"></a>00860   <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4c" title="Connection Type constants of the Forward Open service request Indicates either a.">ForwardOpenConnectionType</a> target_to_originator_connection_type =
<a name="l00861"></a>00861     <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#abe98e638bb3ac01dc06d7d944a1f30bf" title="returns the connection type of the supplied network connection parameter">GetConnectionType</a>(connection_object
<a name="l00862"></a>00862                       -&gt;
<a name="l00863"></a>00863                       t_to_o_network_connection_parameter);
<a name="l00864"></a>00864 
<a name="l00865"></a>00865   <span class="comment">/* open a connection &quot;point to point&quot; or &quot;multicast&quot; based on the ConnectionParameter */</span>
<a name="l00866"></a>00866   <span class="keywordflow">if</span> (originator_to_target_connection_type ==
<a name="l00867"></a>00867       <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4ca8ee5c4f2e59cc457d3981e241811c6c7">kForwardOpenConnectionTypeMulticastConnection</a>)                                         <span class="comment">/* Multicast consuming */</span>
<a name="l00868"></a>00868   {
<a name="l00869"></a>00869     <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#a9937b2aeb5fd393c7861e25f04c9f1c1">OpenMulticastConnection</a>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>,
<a name="l00870"></a>00870                                 connection_object, common_packet_format_data)
<a name="l00871"></a>00871         == <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>) {
<a name="l00872"></a>00872       <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;error in OpenMulticast Connection\n&quot;</span>);
<a name="l00873"></a>00873       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00874"></a>00874     }
<a name="l00875"></a>00875   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (originator_to_target_connection_type ==
<a name="l00876"></a>00876              <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4cafd1fb241e217db9124e88db0271040d3">kForwardOpenConnectionTypePointToPointConnection</a>)                                         <span class="comment">/* Point to Point consuming */</span>
<a name="l00877"></a>00877   {
<a name="l00878"></a>00878     <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#a36b4eefe81166b26625074031ba87234" title="Open a Point2Point connection dependent on pa_direction.">OpenConsumingPointToPointConnection</a>(connection_object,
<a name="l00879"></a>00879                                             common_packet_format_data)
<a name="l00880"></a>00880         == <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>) {
<a name="l00881"></a>00881       <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;error in PointToPoint consuming connection\n&quot;</span>);
<a name="l00882"></a>00882       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00883"></a>00883     }
<a name="l00884"></a>00884   }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886   <span class="keywordflow">if</span> (target_to_originator_connection_type ==
<a name="l00887"></a>00887       <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4ca8ee5c4f2e59cc457d3981e241811c6c7">kForwardOpenConnectionTypeMulticastConnection</a>)                                         <span class="comment">/* Multicast producing */</span>
<a name="l00888"></a>00888   {
<a name="l00889"></a>00889     <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#a281f0a261db50e297593dd3383093fb0">OpenProducingMulticastConnection</a>(connection_object,
<a name="l00890"></a>00890                                          common_packet_format_data)
<a name="l00891"></a>00891         == <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>) {
<a name="l00892"></a>00892       <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;error in OpenMulticast Connection\n&quot;</span>);
<a name="l00893"></a>00893       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00894"></a>00894     }
<a name="l00895"></a>00895   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (target_to_originator_connection_type ==
<a name="l00896"></a>00896              <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#ab22bbae42458677f47f6024cfb96ac4cafd1fb241e217db9124e88db0271040d3">kForwardOpenConnectionTypePointToPointConnection</a>)                                         <span class="comment">/* Point to Point producing */</span>
<a name="l00897"></a>00897   {
<a name="l00898"></a>00898 
<a name="l00899"></a>00899     <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#ab5ba6f9cb3103c1db76c2bf7ae3cce8d">OpenProducingPointToPointConnection</a>(connection_object,
<a name="l00900"></a>00900                                             common_packet_format_data)
<a name="l00901"></a>00901         != <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>) {
<a name="l00902"></a>00902       <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;error in PointToPoint producing connection\n&quot;</span>);
<a name="l00903"></a>00903       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00904"></a>00904     }
<a name="l00905"></a>00905   }
<a name="l00906"></a>00906   <span class="keywordflow">return</span> eip_status;
<a name="l00907"></a>00907 }
<a name="l00908"></a>00908 
<a name="l00909"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#ab63a9cebd7f44ee474ac1fd446d5bc66">00909</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#ab63a9cebd7f44ee474ac1fd446d5bc66" title="close the communication channels of the given connection and remove it from the active connections li...">CloseCommunicationChannelsAndRemoveFromActiveConnectionsList</a>(
<a name="l00910"></a>00910   <a class="code" href="../../d1/d48/structconnection__object.html">ConnectionObject</a> *<a class="code" href="../../d1/d48/structconnection__object.html">connection_object</a>) {
<a name="l00911"></a>00911   <a class="code" href="../../db/d4f/generic__networkhandler_8c.html#a37e718bdfa6e3b780b5135330b9cb5e5">IApp_CloseSocket_udp</a>(
<a name="l00912"></a>00912     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>]);
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>] =
<a name="l00915"></a>00915     kEipInvalidSocket;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917   <a class="code" href="../../db/d4f/generic__networkhandler_8c.html#a37e718bdfa6e3b780b5135330b9cb5e5">IApp_CloseSocket_udp</a>(
<a name="l00918"></a>00918     connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>]);
<a name="l00919"></a>00919 
<a name="l00920"></a>00920   connection_object-&gt;<a class="code" href="../../d1/d48/structconnection__object.html#af79cffac5d391cb48b836dca8b893fe4">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00921"></a>00921     kEipInvalidSocket;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923   <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#aef50a0eee3ff5df3320b49f872a7f3c4" title="Removes connection from the list of active connections.">RemoveFromActiveConnections</a>(connection_object);
<a name="l00924"></a>00924 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../df/d03/cipioconnection_8c.html">cipioconnection.c</a>      </li>

    <li class="footer">Generated on Wed Feb 15 2017 11:16:57 for OpENer - Open Source EtherNet/IP(TM)  I/O Target Stack by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
